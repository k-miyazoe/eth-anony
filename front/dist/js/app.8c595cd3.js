(function(){"use strict";var e={5705:function(e,t,s){var o=s(144),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("router-view")],1)},a=[],r={name:"App"},i=r,l=s(3736),c=s(3453),u=s.n(c),d=s(998),h=(0,l.Z)(i,n,a,!1,null,null,null),_=h.exports;u()(h,{VApp:d.Z});var v=s(8345),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-main",[s("v-row",{staticClass:"justify-center"},[s("v-btn",{on:{click:e.routerPushCreateQuestion}},[e._v("質問する")])],1),s("v-container",{attrs:{fluid:""}},e._l(e.unresolved_question,(function(t){return s("v-card",{key:t.id,staticClass:"pa-md-4 mx-lg-auto",attrs:{width:"750px"}},[s("v-card-text",[s("router-link",{attrs:{to:{name:"question-detail",params:{id:t.id}}}},[e._v(" "+e._s(t.question_title)+" ")])],1),s("v-card-text",[e._v(" 回答数:"+e._s(t.question_number_of_responses)+" 閲覧数:"+e._s(t.question_views)+" ")])],1)})),1)],1)],1)},g=[],w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-app-bar",{attrs:{color:"#00B0FF",dense:"",dark:"",elevation:"10"}},[s("v-toolbar-title",[e._v(" 質問掲示板 - プログラミング概論 ")]),s("v-spacer"),e.login_status?s("div",[s("v-btn",[s("router-link",{attrs:{to:"/mypage"}},[e._v(" マイページ ")])],1)],1):s("div",[s("v-btn",[s("router-link",{attrs:{to:"/signin"}},[e._v(" サインイン ")])],1),s("v-btn",[s("router-link",{attrs:{to:"/signup"}},[e._v(" サインアップ ")])],1)],1)],1),s("div",{staticStyle:{padding:"15px"}})],1)},m=[],f={components:{},data:()=>({uid:0,login_status:!1}),mounted(){this.setURLParameter()},methods:{setURLParameter(){this.$session.has("token")&&(console.log("Header.vue set uid",this.$session.get("user_id")),this.uid=this.$session.get("user_id"),this.login_status=!0)}}},b=f,k=s(5716),x=s(5146),y=s(3687),C=s(7953),q=(0,l.Z)(b,w,m,!1,null,null,null),A=q.exports;u()(q,{VAppBar:k.Z,VBtn:x.Z,VSpacer:y.Z,VToolbarTitle:C.qW});var Z=s(9669),B=s.n(Z);const V="http://localhost:9990";var E={components:{Header:A},data(){return{tab:null,unresolved_question:{},resolved_question:{},my_question:{},items:[]}},mounted(){this.getUnresolvedQuestion()},methods:{getUnresolvedQuestion(){B().get(V+"/api/get-question/unresolved/").then((e=>{this.unresolved_question=e.data})).catch((e=>{console.log(e)}))},getResolvedQuestion(){B().get(V+"/api/get-question/resolved/").then((e=>{console.log(e.data),this.resolved_question=e.data})).catch((e=>{console.log(e)}))},getMyQuestion(){B().get(V+"/api/get-question/").then((e=>{console.log(e.data)})).catch((e=>{console.log(e)}))},routerPushCreateQuestion(){this.$router.push("/create-question")}}},$=E,T=s(9582),j=s(4886),H=s(9256),Q=s(3059),P=s(1713),S=(0,l.Z)($,p,g,!1,null,null,null),O=S.exports;u()(S,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardText:j.ZB,VContainer:H.Z,VMain:Q.Z,VRow:P.Z});var D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-container",{attrs:{"grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:"","align-center":"","justify-center":"","fill-height":""}},[s("v-flex",{attrs:{xs12:"",sm8:"",lg4:"",md5:""}},[s("v-card",{staticClass:"mt-12"},[s("v-card-title",[s("span",{staticClass:"headline"},[e._v("実名アカウント")])]),s("v-spacer"),s("v-card-text",[e.loading?s("v-layout",{attrs:{row:"","fill-height":"","justify-center":"","align-center":""}},[s("v-progress-circular",{attrs:{size:50,color:"primary",indeterminate:""}})],1):s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-container",[s("v-text-field",{attrs:{label:"ユーザーID*(半角英数)",rules:e.rules.user_key,required:""},model:{value:e.main_account.user_key,callback:function(t){e.$set(e.main_account,"user_key",t)},expression:"main_account.user_key"}}),s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード*(半角英数)",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.main_account.password,callback:function(t){e.$set(e.main_account,"password",t)},expression:"main_account.password"}}),s("v-text-field",{attrs:{type:"password",counter:20,label:"パスワード(確認用)*",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.check_password_main,callback:function(t){e.check_password_main=t},expression:"check_password_main"}}),s("v-text-field",{attrs:{label:"学籍番号メールアドレス*",rules:e.rules.email,required:""},model:{value:e.main_account.user_email,callback:function(t){e.$set(e.main_account,"user_email",t)},expression:"main_account.user_email"}}),s("v-text-field",{attrs:{label:"氏名*",rules:e.rules.user_name,required:""},model:{value:e.main_account.user_name,callback:function(t){e.$set(e.main_account,"user_name",t)},expression:"main_account.user_name"}})],1)],1)],1)],1),s("v-card",{staticClass:"mt-12"},[s("v-card-title",[s("span",{staticClass:"headline"},[e._v("匿名アカウント")])]),s("v-card-subtitle",[e._v("*実名アカウントとは違うユーザーID,パスワードを登録してください")]),s("v-spacer"),s("v-card-text",[e.loading?s("v-layout",{attrs:{row:"","fill-height":"","justify-center":"","align-center":""}},[s("v-progress-circular",{attrs:{size:50,color:"primary",indeterminate:""}})],1):s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-container",[s("v-text-field",{attrs:{label:"ユーザーID*(半角英数)",rules:e.rules.user_key,required:""},model:{value:e.sub_account.user_key,callback:function(t){e.$set(e.sub_account,"user_key",t)},expression:"sub_account.user_key"}}),s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード*(半角英数)",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.sub_account.password,callback:function(t){e.$set(e.sub_account,"password",t)},expression:"sub_account.password"}}),s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード(確認用)*",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.check_password_sub,callback:function(t){e.check_password_sub=t},expression:"check_password_sub"}}),s("v-text-field",{attrs:{label:"学籍番号メールアドレス(任意)"},model:{value:e.sub_account.email,callback:function(t){e.$set(e.sub_account,"email",t)},expression:"sub_account.email"}})],1)],1)],1)],1),s("router-link",{attrs:{to:"/signin"}},[e._v(" アカウントがある方はこちらから ")]),s("v-btn",{staticClass:"pink white--text",attrs:{disabled:!e.valid},on:{click:e.signUp}},[e._v(" サインアップ ")])],1)],1)],1)],1)},F=[],I=s(6455),U=s.n(I),R=s(1955);function M(){const e=R.Z.get("csrftoken"),t=B().create({baseURL:"http://localhost:9990",timeout:2500,headers:{"Content-Type":"application/json","X-CSRFToken":e}});return t}var N={setHeader:M};const z=N.setHeader(),G=s(7918),L=new G("https://eagle4.fu.is.saga-u.ac.jp/geth-docker/"),W="0x7A5601125AC4CC81647E61c0347Ef58E2Cf8cf02",X="admin";let J="",K="";var Y={components:{Header:A},data:()=>({main_account:{},sub_account:{},valid:!0,loading:!1,check_password_main:"",check_password_sub:"",rules:{user_key:[e=>!!e||"ユーザーidは必須です"],email:[e=>!!e||"メールアドレスは必須です"],password:[e=>!!e||"パスワードは必須です",e=>e&&e.length>7||"パスワードは8文字以上でなければなりません"],user_name:[e=>!!e||"名前は必須です"]}}),mounted(){this.checkToken(),this.checkGeth()},methods:{checkToken(){this.$session.start(),this.$session.has("token")&&jt.push("/")},checkGeth(){L.eth.personal.getAccounts().then((e=>{console.log("geth 起動中")}),(e=>{console.log("geth 停止中",e),this.valid=!1}))},async signUp(){this.loading=!0;let e=!0;e=this.checkForm(),e=this.checkUserId(e),e=this.checkPassword(this.main_account.password,this.check_password_main,e),e=this.checkPassword(this.sub_account.password,this.check_password_sub,e),e=this.checkMainSubPassword(this.main_account.password,this.sub_account.password),await this.createEthAccount(this.main_account.password,e,"main"),await this.createEthAccount(this.sub_account.password,e,"sub"),e=this.checkEthAddressType(J,K),console.log("check eth address typeのflag確認",e),await this.createAccount(this.main_account,100,e,J),console.log("5 createAccount main",e),await this.createAccount(this.sub_account,0,e,K),console.log("6 createAccount sub",e),await this.initialEth(J,100,e),console.log("7 initialEth",e),this.loading=!1,this.signUpResult(e)},checkForm(){return this.$refs.form.validate()},checkUserId(e){return e?this.main_account.user_key!=this.sub_account.user_key||(U().fire({icon:"warning",title:"Error",text:"ユーザーidが一致しています.どちらか変更してください",showConfirmButton:!1,showCloseButton:!1,timer:1e3}),!1):(console.log("userkey checkなし"),!1)},checkPassword(e,t,s){return s?e==t||(U().fire({icon:"warning",title:"Error",text:"パスワードが一致しません.もう一度入力してください",showConfirmButton:!1,showCloseButton:!1,timer:1e3}),this.loading=!1,this.main_account.password="",this.sub_account.password="",this.check_password="",!1):(console.log("パスワードチェックなし"),!1)},checkMainSubPassword(e,t){return e==t?(U().fire({icon:"warning",title:"Error",text:"実名アカウントもしくは匿名アカウントどちらかのパスワードを変更してください",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),!1):(console.log("mainとsubパスワード重複なし"),!0)},async createEthAccount(e,t,s){if(!t)return console.log("ethアカウント生成しない"),!1;await L.eth.personal.newAccount(e).then((e=>("main"==s?(console.log("ethアカウント作成ok[main]",e,"ethアドレスの型",typeof e),J=e):(console.log("ethアカウント作成ok[sub]",e,"ethアドレスの型",typeof e),K=e),!0)),(e=>(console.log("error",e),!1)))},checkEthAddressType(e,t){return"string"==typeof e&&"string"==typeof t},getStudentNumber(e){const t=e.replace(/[^0-9]/g,"");return console.log("学籍番号抽出確認",t),t},groupingAccount(e){return e%2==0},async createAccount(e,t,s,o){if(!s)return console.log("アカウント生成しない"),U().fire({icon:"warning",title:"Error",text:"アカウントが作成できませんでした",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),!1;const n=this.getStudentNumber(this.main_account.user_email);e.user_group=this.groupingAccount(n),e.user_eth_password=e.password,e.user_point=t,e.user_eth_address=o,console.log("createAccount:",e),await z.post("/api/create-user/",e).then((()=>(console.log("アカウント作成"),!0))).catch((()=>(U().fire({icon:"warning",title:"Error",text:"入力が正しくありません",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),!1)))},async initialEth(e,t,s){if(!s)return console.log("初期eth与えない"),!1;const o=await L.utils.toChecksumAddress(W),n=await L.utils.toChecksumAddress(e),a={from:o,to:n,value:t};await L.eth.personal.unlockAccount(o,X,15e3).then((()=>{L.eth.sendTransaction(a),console.log("受け取り完了")}))},signUpResult(e){e?(U().fire("アカウントを作成しました!","success"),jt.push("/signin")):(U().fire({icon:"warning",title:"Error",text:"アカウントの作成ができませんでした!ページを閉じて再度やり直してください",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),this.loading=!1)},async log(){}}},ee=Y,te=s(1267),se=s(5125),oe=s(3201),ne=s(3305),ae=s(2033),re=(0,l.Z)(ee,D,F,!1,null,null,null),ie=re.exports;u()(re,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardSubtitle:j.Qq,VCardText:j.ZB,VCardTitle:j.EB,VContainer:H.Z,VFlex:te.Z,VForm:se.Z,VLayout:oe.Z,VProgressCircular:ne.Z,VSpacer:y.Z,VTextField:ae.Z});var le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-container",{attrs:{"grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:"","align-center":"","justify-center":"","fill-height":""}},[s("v-flex",{attrs:{xs12:"",sm8:"",lg4:"",md5:""}},[s("v-card",{staticClass:"mt-12"},[s("v-card-title",[s("span",{staticClass:"headline"},[e._v("サインイン")])]),s("v-card-text",[e.loading?s("v-layout",{attrs:{row:"","fill-height":"","justify-center":"","align-center":""}},[s("v-progress-circular",{attrs:{size:50,color:"primary",indeterminate:""}})],1):s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-container",[s("v-text-field",{attrs:{label:"ユーザーID",rules:e.rules.user_key,required:""},model:{value:e.credentials.user_key,callback:function(t){e.$set(e.credentials,"user_key",t)},expression:"credentials.user_key"}}),s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード",rules:e.rules.password,maxlength:"10",required:""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.signIn.apply(null,arguments)}},model:{value:e.credentials.password,callback:function(t){e.$set(e.credentials,"password",t)},expression:"credentials.password"}})],1),s("v-btn",{staticClass:"pink white--text",attrs:{disabled:!e.valid},on:{click:e.signIn}},[e._v(" サインイン ")])],1)],1)],1),s("router-link",{attrs:{to:"/signup"}},[e._v(" アカウントを登録していない方はこちらから ")])],1)],1)],1)],1)},ce=[];const ue="http://localhost:9990";var de={components:{Header:A},data:()=>({credentials:{},valid:!0,loading:!1,rules:{user_key:[e=>!!e||"ユーザーIDは必須です"],password:[e=>!!e||"パスワードは必須です",e=>e&&e.length>7||"パスワードは8文字以上でなければなりません"]},axios:{},user_id:null}),mounted(){this.checkToken()},methods:{signIn(){this.$refs.form.validate()&&(this.loading=!0,B().post(ue+"/auth/",this.credentials).then((e=>{this.$session.start(),this.$session.set("token",e.data.token),this.$session.set("user_id",e.data.user_id),this.$session.set("user_name",e.data.user_name),this.$session.set("user_eth_address",e.data.user_eth_address),this.$session.set("user_group",e.data.user_group),this.loading=!1,jt.push("/")})).catch((e=>{this.loading=!1,console.log(e),U().fire({icon:"warning",title:"Error",text:"ユーザーIDもしくはパスワード、または両方が間違っています",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),this.credentials.password=""})))},checkToken(){this.$session.start(),this.$session.has("token")&&jt.push("/")}}},he=de,_e=(0,l.Z)(he,le,ce,!1,null,null,null),ve=_e.exports;u()(_e,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardText:j.ZB,VCardTitle:j.EB,VContainer:H.Z,VFlex:te.Z,VForm:se.Z,VLayout:oe.Z,VProgressCircular:ne.Z,VTextField:ae.Z});var pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-main",[s("NavHelpBar"),s("v-container",{attrs:{"grid-list-md":""}},[s("v-card",[s("v-card-title",[e._v("MyPage")]),s("v-card-text",[e._v(" ユーザー名: "+e._s(e.user_info.user_name)+" ")]),s("v-card-text",[e._v(" 所持: "+e._s(e.user_has_eth)+" point ")]),s("v-card-text",[e._v(" メールアドレス: "+e._s(e.user_info.user_email)+" ")])],1)],1),s("v-container",{attrs:{"grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:"","align-center":"","justify-center":"","fill-height":""}},[s("v-flex",{attrs:{xs12:"",sm8:"",lg4:"",md5:""}},[s("v-card",[s("v-card-title",[s("span",{staticClass:"headline"},[e._v("仮想通貨を送る")])]),s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-text-field",{attrs:{counter:10,rules:e.rules.address,label:"送り先のユーザーID",required:""},model:{value:e.forward_address,callback:function(t){e.forward_address=t},expression:"forward_address"}}),s("v-text-field",{attrs:{rules:e.rules.eth,label:"ETH",required:""},model:{value:e.send_eth,callback:function(t){e.send_eth=e._n(t)},expression:"send_eth"}}),s("v-text-field",{attrs:{rules:e.rules.password,label:"Password",required:""},model:{value:e.my_eth_password,callback:function(t){e.my_eth_password=t},expression:"my_eth_password"}}),s("v-btn",{staticClass:"mr-4",attrs:{disabled:!e.valid,color:"success"},on:{click:function(t){return e.sendEth()}}},[e._v(" 送金 ")])],1)],1)],1)],1)],1)],1)],1)},ge=[],we=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-breadcrumbs",{attrs:{items:e.items},scopedSlots:e._u([{key:"divider",fn:function(){return[s("v-icon",[e._v("mdi-forward")])]},proxy:!0}])})],1)},me=[],fe={data:()=>({items:[{text:"ホーム",disabled:!1,href:"/"}]})},be=fe,ke=s(9286),xe=s(4324),ye=(0,l.Z)(be,we,me,!1,null,null,null),Ce=ye.exports;u()(ye,{VBreadcrumbs:ke.Z,VIcon:xe.Z});const qe=N.setHeader(),Ae=s(7918),Ze=new Ae("https://eagle4.fu.is.saga-u.ac.jp/geth-docker/");let Be="",Ve=!0;var Ee={components:{Header:A,NavHelpBar:Ce},data:()=>({valid:!0,uid:"",user_id:null,user_info:{},user_has_eth:0,forward_address:"",send_eth:0,my_eth_password:"",rules:{address:[e=>!!e||"送り先は必須です"],eth:[e=>!!e||"必須です",e=>/^[0-9]+$/.test(e)||"数値のみ"],password:[e=>!!e||"パスワードは必須です"]}}),mounted(){this.checkToken(),this.getUserInfo(),this.checkGeth(),this.getHasEth()},methods:{checkToken(){this.$session.start(),this.$session.has("token")||jt.push("/signin"),Be=this.$session.get("user_eth_address")},checkGeth(){Ze.eth.personal.getAccounts().then((e=>{console.log("geth 起動中")}),(e=>{console.log("geth 停止中",e),this.valid=!1}))},getUserInfo(){const e=this.$session.get("user_id");qe.get("/api/users/"+e).then((e=>{this.user_info=e.data})).catch((e=>{console.log(e)}))},async getHasEth(){await Ze.eth.getBalance(Be).then((e=>{this.user_has_eth=e,console.log("所持eth",e)}))},async getReceiveAddress(){},limitSetting(){return this.user_has_eth>=this.send_eth},async sendEth(){if(Ve=this.limitSetting(),Ve){const e=await Ze.utils.toChecksumAddress(Be),t=await Ze.utils.toChecksumAddress(received_address),s={from:e,to:t,value:this.send_eth,gasPrice:0};await Ze.eth.personal.unlockAccount(e,this.my_eth_password,15e3).then((()=>{Ze.eth.sendTransaction(s),console.log("仮想通貨送金完了")}))}else Swal.fire({icon:"warning",title:"Error",text:"送れる上限を超えています",showConfirmButton:!1,showCloseButton:!1,timer:3e3})},log(){}}},$e=Ee,Te=(0,l.Z)($e,pe,ge,!1,null,null,null),je=Te.exports;u()(Te,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardText:j.ZB,VCardTitle:j.EB,VContainer:H.Z,VFlex:te.Z,VForm:se.Z,VLayout:oe.Z,VMain:Q.Z,VTextField:ae.Z});var He=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-btn",{attrs:{color:"primary"},on:{click:e.log}},[e._v(" log button ")]),s("v-main",[s("NavHelpBar"),s("v-container",[s("v-card",{staticClass:"mt-12"},[s("v-card-title",[s("span",{staticClass:"headline"},[e._v("質問フォーム")])]),e.loading?s("v-layout",{attrs:{row:"","fill-height":"","justify-center":"","align-center":""}},[s("v-progress-circular",{attrs:{size:50,color:"primary",indeterminate:""}})],1):s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-textarea",{attrs:{label:"質問タイトル*",rules:e.rules.question_title,required:"",clearable:"","clear-icon":"mdi-close-circle",rows:"1",outlined:""},model:{value:e.question_obj.question_title,callback:function(t){e.$set(e.question_obj,"question_title",t)},expression:"question_obj.question_title"}}),s("v-textarea",{attrs:{label:"質問内容*",rules:e.rules.question_content,required:"",clearable:"","clear-icon":"mdi-close-circle","auto-grow":"",outlined:""},model:{value:e.question_obj.question_content,callback:function(t){e.$set(e.question_obj,"question_content",t)},expression:"question_obj.question_content"}}),s("v-textarea",{attrs:{label:"ソースコード[任意]",clearable:"","clear-icon":"mdi-close-circle","auto-grow":"",outlined:""},model:{value:e.question_obj.question_source_code,callback:function(t){e.$set(e.question_obj,"question_source_code",t)},expression:"question_obj.question_source_code"}}),s("v-dialog",{attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on,n=t.attrs;return[s("v-btn",e._g(e._b({attrs:{color:"success",disabled:!e.valid}},"v-btn",n,!1),o),[e._v(" 質問する ")])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",[e._v(" 質問について ")]),s("v-card-text",[e._v(" 質問は削除できません．あとから編集することは可能です． 閲覧者が理解できる質問になっていますか？ ")]),s("v-form",[s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.eth_password,callback:function(t){e.eth_password=t},expression:"eth_password"}})],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"primary"},on:{click:e.postQuestion}},[e._v(" 質問を送信する ")])],1)],1)],1)],1)],1)],1)],1)],1)},Qe=[],Pe=s(759),Se=s.n(Pe);const Oe=class{constructor(e,t){this.user_id=e,this.axios=t}getUserData(){this.axios.get("/api/users/"+this.user_id).then((e=>e.data)).catch((e=>{console.log(e)}))}sendPoint(e){this.axios.put("/api/point-up/"+e+"/").then((()=>{console.log("ポイントを追加しました")})).catch((e=>{console.log(e)}))}sendEther(e){this.axios.put("/api/users/"+e+"/").then((()=>{console.log("ether get")})).catch((e=>{console.log(e)}))}},De=class{constructor(e){this.axios=e}getAll(){console.log("質問取得")}async getOne(e){await this.axios.get("/api/get-question/"+e).then((e=>(console.log("class res.data",e.data),e.data))).catch((e=>{console.log(e)}))}post(e,t){if(!t)return!1;this.axios.post("/api/create-question/",e).then((()=>(console.log("質問投稿しました"),!0))).catch((()=>(U().fire({icon:"warning",title:"Error",text:"入力が正しくありません",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),!1)))}successMessage(e){e?U().fire("Goo job!","success"):U().fire({icon:"warning",title:"Error",text:"質問できませんでした!",showConfirmButton:!1,showCloseButton:!1,timer:3e3})}pointUp(e){this.axios.put("/api/point-up/"+e+"/").then((()=>{console.log("point up")})).catch((e=>{console.log(e)}))}async pointDown(e){await this.axios.put("/api/point-down/"+e+"/").then((()=>{console.log("point down")})).catch((e=>{console.log(e)}))}addNumberOfAnswers(e,t){t&&this.axios.put("/api/add-num-answer/"+e+"/").then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}rewardPoint(){console.log("reward")}likeQuestion(){console.log("like question")}resolvedQuestion(e,t,s,o){if(e==t)if(0!=s.length)if(o){const e={user:t,question_status:!0};this.axios.put("/api/update-question/"+this.question_id+"/",e).then((()=>{U().fire("質問が解決されました!","success")})).catch((e=>{console.log(e)}))}else U().fire({icon:"warning",title:"Error",text:"ベストアンサーが存在しません．ベストアンサーを選択してください!",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else U().fire({icon:"warning",title:"Error",text:"回答が存在しません.自己解決した場合、自身で回答を作成してください",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else U().fire({icon:"warning",title:"Error",text:"質問者のみ有効です！",showConfirmButton:!1,showCloseButton:!1,timer:3e3})}releaseResolvedQuestion(){}},Fe=class{constructor(e){this.axios=e}getAnswer(e){this.axios.get("/api/get-answer/"+e).then((e=>e.data)).catch((e=>{console.log(e)}))}hasBestAnswer(e){let t=!1;for(let s of e)1==s.answer_best&&(console.log("ベストアンサーあり"),t=!0);return t}postAnswer(e,t){t&&this.axios.post("/api/create-answer/",e).then((e=>{console.log(e)})).catch((()=>{U().fire({icon:"warning",title:"Error",text:"入力が正しくありません",showConfirmButton:!1,showCloseButton:!1,timer:3e3})}))}pointDown(e,t){if(!t)return!1;this.axios.put("/api/point-down/"+e+"/").then((()=>(console.log("point down"),!0))).catch((e=>(console.log(e),!1)))}},Ie=N.setHeader();let Ue=0,Re="",Me=null,Ne=null;const ze=s(7918),Ge=new ze("https://eagle4.fu.is.saga-u.ac.jp/geth-docker/"),Le="0x7A5601125AC4CC81647E61c0347Ef58E2Cf8cf02";let We=!0;const Xe="admin";var Je={components:{VueLoading:Se(),Header:A,NavHelpBar:Ce},data(){return{loading:!1,dialog:!1,valid:!0,eth_password:"",question_obj:{user:this.$session.get("user_id"),question_user_name:this.$session.get("user_name")},rules:{question_title:[e=>!!e||"質問タイトルは必須です"],question_content:[e=>!!e||"質問内容は必須です"],password:[e=>!!e||"パスワードを入力してください"]}}},mounted(){this.checkToken(),this.checkGeth()},methods:{checkToken(){this.$session.has("token")||jt.push("/signin"),Ue=this.$session.get("user_id"),Re=this.$session.get("user_eth_address"),Me=this.$session.get("user_group"),Ne=new Oe(Ue,Ie)},checkGeth(){Ge.eth.personal.getAccounts().then((e=>{console.log("geth 起動中")}),(e=>{console.log("geth 停止中",e),this.valid=!1}))},async postQuestion(){this.loading=!0;const e=new De(Ie);await this.getHasEth(Re,1),await this.ethDown(Re,1,this.eth_password,We),e.post(this.question_obj,We),await e.pointDown(Ue),this.questionResult(We)},async getHasEth(e,t){await Ge.eth.getBalance(e).then((e=>{console.log("所持eth",e),We=e-t>0}))},async ethDown(e,t,s,o){if(o){const o=await Ge.utils.toChecksumAddress(e),n=await Ge.utils.toChecksumAddress(Le),a={from:o,to:n,value:t,gasPrice:0};await Ge.eth.personal.unlockAccount(o,s,15e3).then((()=>{Ge.eth.sendTransaction(a),console.log("質問によるethの消費")})).catch((()=>{U().fire({icon:"warning",title:"Error",text:"パスワードが正しくない可能性があります",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),We=!1}))}},questionResult(e){e?(U().fire("質問を投稿しました","success"),jt.push("/signin")):(U().fire({icon:"warning",title:"Error",text:"質問できませんでした",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),this.loading=!1)},async log(){this.initialEth(Re,100)},async initialEth(e,t){const s=await Ge.utils.toChecksumAddress(Le),o=await Ge.utils.toChecksumAddress(e),n={from:s,to:o,value:t};await Ge.eth.personal.unlockAccount(s,Xe,15e3).then((()=>{Ge.eth.sendTransaction(n),console.log("受け取り完了")}))}}},Ke=Je,Ye=s(9202),et=s(9223),tt=s(6072),st=(0,l.Z)(Ke,He,Qe,!1,null,null,null),ot=st.exports;u()(st,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardActions:j.h7,VCardText:j.ZB,VCardTitle:j.EB,VContainer:H.Z,VDialog:Ye.Z,VDivider:et.Z,VForm:se.Z,VLayout:oe.Z,VMain:Q.Z,VProgressCircular:ne.Z,VSpacer:y.Z,VTextField:ae.Z,VTextarea:tt.Z});var nt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("Header"),s("v-main",[s("NavHelpBar"),s("v-container",{attrs:{fluid:""}},[e.one_quesiton.question_status?s("div",[s("v-card",{staticClass:"mx-auto",attrs:{"max-height":"344"}},[s("v-col",{staticClass:"mb-10"},[s("v-card-title",{staticClass:"resolved_question_text"},[e._v("質問 "+e._s(e.one_quesiton.question_title)+" 解決済み! "),s("v-card-subtitle",[e._v("質問者:"+e._s(e.one_quesiton.question_user_name))])],1),s("v-card",[s("v-card-subtitle",[e._v("内容")]),s("v-card-text",[e._v(e._s(e.one_quesiton.question_content))])],1),s("v-card",[s("v-card-subtitle",[e._v("ソースコード")]),s("v-card-text",[e._v(e._s(e.one_quesiton.question_source_code))])],1),s("v-card-actions",[s("v-btn",{attrs:{color:"orange",text:""},on:{click:e.likeQuestion}},[s("v-icon",[e._v("mdi-thumb-up")]),e._v(" "+e._s(e.one_quesiton.question_value)+" ")],1),s("v-btn",{attrs:{color:"green",text:""},on:{click:e.releaseResolvedQuestion}},[e._v(" 解決取り消し ")])],1)],1)],1)],1):s("div",[s("v-card",{staticClass:"mx-auto",attrs:{"max-height":"344"}},[s("v-col",{staticClass:"mb-10"},[s("v-card-title",[e._v("質問 "+e._s(e.one_quesiton.question_title)+" "),s("v-card-subtitle",[e._v("質問者:"+e._s(e.one_quesiton.question_user_name))])],1),s("v-card",[s("v-card-subtitle",[e._v("内容")]),s("v-card-text",[e._v(e._s(e.one_quesiton.question_content))])],1),s("v-card",[s("v-card-subtitle",[e._v("ソースコード")]),s("v-card-text",[e._v(e._s(e.one_quesiton.question_source_code))])],1),s("v-card-actions",[s("v-btn",{attrs:{color:"orange",text:""},on:{click:e.likeQuestion}},[s("v-icon",[e._v("mdi-thumb-up")]),e._v(" "+e._s(e.one_quesiton.question_value)+" ")],1),s("v-btn",{attrs:{color:"green",text:""},on:{click:e.resolvedQuestion}},[e._v(" 解決 ")])],1)],1)],1)],1),s("v-divider"),e._l(e.any_answer,(function(t,o){return s("v-card",{key:o},[t.answer_best?s("div",[s("v-card-title",{staticClass:"best_answer_text"},[e._v("回答 "+e._s(o+1)+" ベストアンサー "),s("v-icon",[e._v("mdi-chess-king")])],1),s("v-card-subtitle",[e._v("回答者:"+e._s(t.answer_user_name))]),s("v-card-text",[e._v(e._s(t.answer_content))]),s("v-card-text",[e._v(e._s(t.answer_source_code))]),s("v-card-actions",[s("v-btn",{attrs:{color:"orange",text:""},on:{click:function(t){return e.likeAnswer(o)}}},[s("v-icon",[e._v("mdi-thumb-up")]),e._v(" "+e._s(t.answer_value)+" ")],1),s("v-btn",{attrs:{color:"red",text:""},on:{click:function(s){return e.releaseBestAnswer(t)}}},[e._v(" 解除 ")])],1)],1):s("div",[s("v-card-title",[e._v("回答 "+e._s(o+1))]),s("v-card-subtitle",[e._v("回答者:"+e._s(t.answer_user_name))]),s("v-card-text",[e._v(e._s(t.answer_content))]),s("v-card-text",[e._v(e._s(t.answer_source_code))]),s("v-card-actions",[s("v-btn",{attrs:{color:"orange",text:""},on:{click:function(t){return e.likeAnswer(o)}}},[s("v-icon",[e._v("mdi-thumb-up")]),e._v(" "+e._s(t.answer_value)+" ")],1),s("v-btn",{attrs:{color:"red",text:""},on:{click:function(s){return e.bestAnswer(t)}}},[e._v(" ベストアンサー ")])],1)],1)])})),s("v-card",{staticClass:"mt-10"},[s("v-card-title",[e._v(" 回答フォーム ")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-textarea",{attrs:{label:"解決策・提案*",rules:e.rules.answer_content,clearable:"","clear-icon":"mdi-close-circle","auto-grow":"",outlined:""},model:{value:e.answer_obj.answer_content,callback:function(t){e.$set(e.answer_obj,"answer_content",t)},expression:"answer_obj.answer_content"}}),s("v-textarea",{attrs:{label:"ソースコード",clearable:"","clear-icon":"mdi-close-circle","auto-grow":"",outlined:""},model:{value:e.answer_obj.answer_source_code,callback:function(t){e.$set(e.answer_obj,"answer_source_code",t)},expression:"answer_obj.answer_source_code"}})],1),s("v-dialog",{attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on,n=t.attrs;return[s("v-btn",e._g(e._b({attrs:{color:"success",disabled:!e.valid}},"v-btn",n,!1),o),[e._v(" 回答する ")])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",[e._v(" 回答について ")]),s("v-card-text",[e._v(" 回答は削除できません．あとから編集することは可能です． 質問者が理解できる回答になっていますか？ ")]),s("v-form",[s("v-text-field",{attrs:{type:"password",counter:10,label:"パスワード",rules:e.rules.password,maxlength:"10",required:""},model:{value:e.eth_password,callback:function(t){e.eth_password=t},expression:"eth_password"}})],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"primary"},on:{click:e.postAnswer}},[e._v(" 回答を送信する ")])],1)],1)],1)],1)],2)],1)],1)},at=[];const rt=N.setHeader();let it=0,lt="",ct=0,ut="",dt="",ht=!1,_t=null;const vt=new De(rt),pt=new Fe(rt),gt=s(7918),wt=new gt("https://eagle4.fu.is.saga-u.ac.jp/geth-docker/"),mt="0x7A5601125AC4CC81647E61c0347Ef58E2Cf8cf02",ft="admin";let bt=!0;var kt={components:{Header:A,NavHelpBar:Ce},data(){return{one_quesiton:{},any_answer:[],answer_obj:{user:this.$session.get("user_id"),answer_user_name:this.$session.get("user_name")},eth_password:"",dialog:!1,valid:!0,loading:!1,rules:{answer_content:[e=>!!e||"回答内容は必須です"],password:[e=>!!e||"パスワードを入力してください"]}}},async mounted(){await this.checkToken(),await this.checkGeth(),await this.getOneQuestion(),await this.getAnyAnswer(),await this.addViewsQuestion(),await this.checkHasBestAnswer()},methods:{checkToken(){this.$session.has("token")||jt.push("/signin"),it=this.$session.get("user_id"),lt=this.$session.get("user_name"),ut=this.$session.get("user_eth_address"),dt=this.$session.get("user_group"),_t=new Oe(it,rt)},checkGeth(){wt.eth.personal.getAccounts().then((e=>{console.log("geth 起動中")}),(e=>{console.log("geth 停止中",e),this.valid=!1}))},getOneQuestion(){ct=Number(this.$route.params.id),rt.get("/api/get-question/"+ct).then((e=>{this.one_quesiton=e.data})).catch((e=>{console.log(e)}))},getAnyAnswer(){rt.get("/api/get-answer/"+ct).then((e=>{this.any_answer=e.data})).catch((e=>{console.log(e)})),console.log("回答取得")},checkHasBestAnswer(){for(let e of this.any_answer)1==e.answer_best&&(console.log("ベストアンサーあり"),ht=!0);return ht},addViewsQuestion(){rt.put("/api/add-views-question/"+ct+"/").then((()=>{console.log("閲覧数追加")})).catch((e=>{console.log(e)}))},async postAnswer(){this.loading=!0,this.answer_obj["question_id"]=ct,this.getHasEth(ut,1),await this.ethDown(ut,1,this.eth_password,bt),console.log("ethの消費",bt),await pt.postAnswer(this.answer_obj,bt),console.log("回答投稿",bt),this.pointDown(it,bt),await vt.addNumberOfAnswers(ct,bt),console.log("回答数増加",bt),this.sendEmailQuestioner(this.answer_obj.answer_content,bt),console.log("メール通知",bt),this.getAnyAnswer(),this.dialog=!1,this.answer_obj={},this.loading=!1},async getHasEth(e,t){await wt.eth.getBalance(e).then((e=>{console.log("所持eth",e),bt=e-t>0}))},async ethDown(e,t,s,o){if(o){const o=await wt.utils.toChecksumAddress(e),n=await wt.utils.toChecksumAddress(mt),a={from:o,to:n,value:t,gasPrice:0};await wt.eth.personal.unlockAccount(o,s,15e3).then((()=>{wt.eth.sendTransaction(a),console.log("回答によるethの消費")})).catch((()=>{U().fire({icon:"warning",title:"Error",text:"パスワードが正しくない可能性があります",showConfirmButton:!1,showCloseButton:!1,timer:3e3}),bt=!1}))}},pointDown(e,t){t&&rt.put("/api/point-down/"+e+"/").then((()=>{console.log("point down")})).catch((e=>{console.log(e)}))},sendEmailQuestioner(e,t){if(t){let t={subject:"質問に回答がありました",message:"[返信不可]"+e,receipt_user_id:this.one_quesiton.user};rt.post("/api/send-email/",t).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}},likeQuestion(){const e={user:it,question_id:this.one_quesiton.id};rt.put("/api/question-like/",e).then((()=>{console.log("評価が変更されました"),this.getOneQuestion()})).catch((e=>{console.log(e)}))},likeAnswer(e){let t={user:it,answer_id:this.any_answer[e].id};rt.post("/api/answer-like/",t).then((e=>{console.log(e),console.log("評価が変更されました"),this.getAnyAnswer()})).catch((e=>{console.log(e)}))},bestAnswer(e){if(this.checkHasBestAnswer())U().fire({icon:"warning",title:"Error",text:"すでにベストアンサーは存在しています！",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else if(it==this.one_quesiton.user){const t={user:this.one_quesiton.user,question_id:ct,answer_best:!0};rt.put("/api/update-answer/"+e.id+"/",t).then((()=>{ht=!0,U().fire("ベストアンサーを決定しました!","success"),this.getAnyAnswer()})).catch((e=>{console.log(e)}))}else U().fire({icon:"warning",title:"Error",text:"質問者のみベストアンサーを決めることができます",showConfirmButton:!1,showCloseButton:!1,timer:3e3})},releaseBestAnswer(e){if(it!=this.one_quesiton.user||this.one_quesiton.question_status)U().fire({icon:"warning",title:"Error",text:"質問者のみベストアンサーを解除できます.また解決済みの場合ベストアンサーは解除できません",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else{const t={user:this.one_quesiton.user,question_id:ct,answer_best:!1};rt.put("/api/update-answer/"+e.id+"/",t).then((()=>{ht=!1,U().fire("ベストアンサーを解除しました!","success"),this.getAnyAnswer()})).catch((e=>{console.log(e)}))}},resolvedQuestion(){if(it==this.one_quesiton.user)if(0!=this.any_answer.length)if(this.checkHasBestAnswer()){const e={user:this.one_quesiton.user,question_status:!0};rt.put("/api/update-question/"+ct+"/",e).then((()=>{U().fire("質問が解決されました!","success"),this.getOneQuestion()})).catch((e=>{console.log(e)}))}else U().fire({icon:"warning",title:"Error",text:"ベストアンサーが存在しません．ベストアンサーを選択してください!",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else U().fire({icon:"warning",title:"Error",text:"回答が存在しません.自己解決した場合、自身で回答を作成してください",showConfirmButton:!1,showCloseButton:!1,timer:3e3});else U().fire({icon:"warning",title:"Error",text:"質問者のみ有効です！",showConfirmButton:!1,showCloseButton:!1,timer:3e3})},releaseResolvedQuestion(){if(it==this.one_quesiton.user){const e={user:this.one_quesiton.user,question_status:!1};rt.put("/api/update-question/"+ct+"/",e).then((()=>{U().fire("解決を取り消しました!","success"),this.getOneQuestion()})).catch((e=>{console.log(e)}))}else U().fire({icon:"warning",title:"Error",text:"質問者のみ有効です！",showConfirmButton:!1,showCloseButton:!1,timer:3e3})},async rewardEth(e,t){const s=await wt.utils.toChecksumAddress(mt),o=await wt.utils.toChecksumAddress(e),n={from:s,to:o,value:t};await wt.eth.personal.unlockAccount(s,ft,15e3).then((()=>{wt.eth.sendTransaction(n),console.log("受け取り完了")}))},putSendPoint(){rt.put("/api/users/"+it+"/",update_obj).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))},log(){},async initialEth(e,t){const s=await wt.utils.toChecksumAddress(mt),o=await wt.utils.toChecksumAddress(e),n={from:s,to:o,value:t};await wt.eth.personal.unlockAccount(s,ft,15e3).then((()=>{wt.eth.sendTransaction(n),console.log("受け取り完了")}))}}},xt=kt,yt=s(266),Ct=(0,l.Z)(xt,nt,at,!1,null,null,null),qt=Ct.exports;u()(Ct,{VApp:d.Z,VBtn:x.Z,VCard:T.Z,VCardActions:j.h7,VCardSubtitle:j.Qq,VCardText:j.ZB,VCardTitle:j.EB,VCol:yt.Z,VContainer:H.Z,VDialog:Ye.Z,VDivider:et.Z,VForm:se.Z,VIcon:xe.Z,VMain:Q.Z,VSpacer:y.Z,VTextField:ae.Z,VTextarea:tt.Z});var At=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Zt=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h1",[e._v("ページが存在しません")])])}],Bt={},Vt=(0,l.Z)(Bt,At,Zt,!1,null,null,null),Et=Vt.exports;o["default"].use(v.Z);const $t=[{path:"/",name:"home",component:O},{path:"/signup",component:ie},{path:"/signin",component:ve},{path:"/create-question",component:ot},{path:"/question/:id",component:qt,props:!0,name:"question-detail"},{path:"/mypage",component:je,props:!0,name:"mypage"},{path:"*",component:Et,name:"notFound"},{path:"/:pathMatch(.*)*",redirect:{name:"home"},meta:{isPublic:!0}}],Tt=new v.Z({mode:"history",routes:$t});var jt=Tt,Ht=s(8864);o["default"].use(Ht.Z);var Qt=new Ht.Z({}),Pt=s(3757),St=s.n(Pt);o["default"].config.productionTip=!1,o["default"].use(St()),new o["default"]({router:jt,vuetify:Qt,render:e=>e(_)}).$mount("#app")}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,o,n,a){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],n=e[u][1],a=e[u][2];for(var i=!0,l=0;l<o.length;l++)(!1&a||r>=a)&&Object.keys(s.O).every((function(e){return s.O[e](o[l])}))?o.splice(l--,1):(i=!1,a<r&&(r=a));if(i){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,n,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,a,r=o[0],i=o[1],l=o[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(l)var u=l(s)}for(t&&t(o);c<r.length;c++)a=r[c],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},o=self["webpackChunkfront"]=self["webpackChunkfront"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(5705)}));o=s.O(o)})();
//# sourceMappingURL=app.8c595cd3.js.map